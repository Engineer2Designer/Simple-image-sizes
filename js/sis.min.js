var rahe;if(rahe){if("object"!==typeof rahe)throw Error("rahe already exists and not an object");}else rahe={};if(rahe.sis){if("object"!==typeof rahe.sis)throw Error("rahe.sis already exists and not an object");}else rahe.sis={};
rahe.sis.regenerate={post_types:"",thumbnails:"",list:"",cur:0,timeScript:[],dateScript:"",percent:"",getThumbnails:function(){var b=this,a=jQuery("input.thumbnails:checked");a.length!=jQuery('input.thumbnails[type="checkbox"]').length&&a.each(function(){b.thumbnails+="&thumbnails[]="+jQuery(this).val()})},getPostTypes:function(){var b=this,a=jQuery("input.post_types:checked");a.length!=jQuery('input.post_types[type="checkbox"]').length&&a.each(function(){b.post_types+="&post_types[]="+jQuery(this).val()})},
setMessage:function(b){jQuery("#regenerate_message").html("<p>"+b+"</p>").addClass("updated").addClass("fade").show();this.refreshProgressBar()},setTimeMessage:function(b){jQuery("#time p span.time_message").html(b)},refreshProgressBar:function(){jQuery(".progress").progressbar()},checkStartRegenerating:function(){if(0<jQuery(".notSaved").size())if(!0==confirm(sis.notSaved))this.startRegenerating();else return!1;else this.startRegenerating()},startRegenerating:function(){var b=this,a=jQuery("input.getList").val();
this.dateScript=new Date;jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_get_list&"+b.post_types+"&nonce="+a,beforeSend:function(){jQuery("#ajax_thumbnail_rebuild").attr("disabled",!0);b.setMessage(sis.reading);b.getThumbnails();b.getPostTypes()},success:function(a){if("object"!==typeof a)return b.reInit(),b.setMessage(sis.phpError),!1;jQuery("#time").show();b.list=a;b.curr=0;jQuery(".progress").show();b.regenItem()}})},regenItem:function(){var b=this,a=jQuery("input.regen").val();
if(!this.list)return this.reInit(),this.setMessage(sis.noMedia),!1;this.curr>=this.list.length?(a=new Date,this.reInit(),this.setMessage(sis.done+this.curr+" "+sis.messageRegenerated+sis.startedAt+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+sis.finishedAt+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds())):(this.setMessage(sis.regenerating+(this.curr+1)+sis.of+this.list.length+" ("+this.list[this.curr].title+")..."),jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:"action=sis_rebuild_image&id="+
this.list[this.curr].id+this.thumbnails+"&nonce="+a,beforeSend:function(){b.percent=100*(b.curr/b.list.length);jQuery(".progress").progressbar("value",b.percent);jQuery(".progress-percent span.text").html(Math.round(b.percent)+"%").closest(".progress-percent").animate({left:Math.round(b.percent)-2.5+"%"},500)},success:function(a){if(!a.src||!a.time||a.error||"object"!==typeof a){var e="",e="object"!==typeof a?sis.phpError:a.error;jQuery("#error_messages").addClass("error message");jQuery("#error_messages ul.messages").prepend("<li>"+
e+"</li>")}else{a.message&&jQuery("#time ul.messages").prepend("<li>"+a.message+"</li>");var e=new Date,f=new Date,g=0;sum=0;jQuery("#thumb").show();jQuery("#thumb-img").attr("src",a.src);b.timeScript.push(a.time);g=b.timeScript.length;for(a=0;a<g;a++)sum+=b.timeScript[a];a=Math.round(1E3*sum/g*b.list.length);e.setTime(b.dateScript.getTime()+a);f=b.s2t((e.getTime()-f.getTime())/1E3);b.setTimeMessage(e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+sis.or+f+sis.beforeEnd)}b.curr++;b.regenItem()}}))},
s2t:function(b){b%=86400;var a=new Date(1970,0,1),c=0;a.setSeconds(b);c=a.toTimeString().substr(0,8);86399<b&&(c=Math.floor((a-Date.parse("1/1/70"))/36E5)+c.substr(2));return c},reInit:function(){jQuery("#ajax_thumbnail_rebuild").removeAttr("disabled");jQuery(".progress, #thumb").hide()}};
rahe.sis.sizes={i:0,add:function(b,a){b.preventDefault();var c=_.template(document.getElementById("sis-new_size").text,{size_id:this.i,validate:sis.validate});jQuery(a).closest("tr").before(c);this.i++},register:function(b,a){b.preventDefault();var c=jQuery(a).closest("tr").children("th").find("input").val(),e=jQuery(a).closest("tr").children("th").find("input").attr("id"),f=jQuery(a).closest("tbody").find('input[value="'+c+'"]').length;if("thumbnail"==c||"medium"==c||"large"==c)return alert(sis.notOriginal),
!1;if(0!=f)return alert(sis.alreadyPresent),!1;c=_.template(document.getElementById("sis-new_size_row").text,{size:sis.size,size_name:c,maximumWidth:sis.maximumWidth,maximumHeight:sis.maximumHeight,customName:sis.customName,crop:sis.crop,show:sis.show,deleteImage:sis.deleteImage,validateButton:sis.validateButton});jQuery("#"+e).closest("tr").html(c);this.setButtons()},deleteSize:function(b,a){b.preventDefault();!0==confirm(sis.confirmDelete)&&(jQuery(a).closest("tr").remove(),this.ajaxUnregister(a))},
getPhp:function(b,a){b.preventDefault();var c=jQuery(a).closest("tr");jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"sis_get_sizes"},beforeSend:function(){c.removeClass("addPending");c.addClass("addPending")},success:function(a){jQuery("#get_php").nextAll("code").html("<br />"+a).show().css({display:"block"});c.removeClass("addPending")}})},ajaxRegister:function(b,a){b.preventDefault();var c=this,e=jQuery(a).closest("table"),f,g=jQuery(".addSize").val(),d=jQuery(a).closest("tr"),k=d.find('input[name="image_name"]').val(),
j=d.find("label.c").hasClass("ui-state-active"),l=d.find("label.s").hasClass("ui-state-active"),m=d.find("input.n").val();w=h=0;j=!1==j||void 0==j?!1:!0;l=!1==l||void 0==l?!1:!0;w=parseInt(d.find("input.w").val());h=parseInt(d.find("input.h").val());e.hasClass("ajaxing")||jQuery.ajax({url:sis.ajaxUrl,type:"POST",dataType:"json",data:{action:"sis_add_size",width:w,height:h,crop:j,name:k,show:l,customName:m,nonce:g},beforeSend:function(){d.removeClass();d.addClass("addPending");e.addClass("ajaxing")},
success:function(a){var b="";d.removeClass();e.removeClass("ajaxing");0==a?b="errorAdding":(b=2==a?"notChangedAdding":"successAdding",c.addToArray(k,w,h,j,b));d.find("input.h").attr({base_h:h});d.find("input.w").attr({base_w:w});d.find("input.c").attr({base_c:j});d.find("input.s").attr({base_s:l});d.addClass(b);d.find("td").removeClass("notSaved");d.find(".add_size").removeClass("validate_size").hide().children(".ui-button-text").text(sis.update);clearTimeout(f);f=setTimeout(function(){d.removeClass("errorAdding notChangedAdding successAdding")},
3E3)}})},ajaxUnregister:function(b){var a=this,c=jQuery(b).closest("tr").find('input[name="image_name"]').val(),e=jQuery(b).closest("tr").find("input.deleteSize").val();jQuery.ajax({url:sis.ajaxUrl,type:"POST",data:{action:"sis_remove_size",name:c,nonce:e},success:function(){a.removeFromArray(b)}})},addToArray:function(b,a,c,e,f){var g=jQuery('#sis-regen .wrapper > table#sis_sizes > tbody input[value="'+b+'"]'),d="",k,d=0!=g.length?g.closest("tr"):jQuery("#sis-regen .wrapper > table#sis_sizes > tbody > tr:first").clone();
e=!0==e?sis.tr:sis.fl;d.find("th > label").attr("for",b).end().find("input.thumbnails").val(b).attr("id",b).end().find("th:nth-child(2) > label").text(b).end().find("th:nth-child(3) > label").text(a+"px").end().find("th:nth-child(4) > label").text(c+"px").end().find("th:nth-child(5) > label").text(e);0==g.length&&d.appendTo("#sis-regen .wrapper > table#sis_sizes > tbody");d.removeClass("errorAdding notChangedAdding successAdding").addClass(f);clearTimeout(k);k=setTimeout(function(){d.removeClass("errorAdding notChangedAdding successAdding")},
3E3)},removeFromArray:function(b){b=jQuery(b).closest("tr").find("input[name=image_name]").val();jQuery('#sis-regen .wrapper > table#sis_sizes > tbody input[value="'+b+'"]').closest("tr").remove()},setButtons:function(){jQuery(".delete_size").button({icons:{primary:"ui-icon-circle-close"},text:!0});jQuery(".add_size").button({icons:{primary:"ui-icon-check"},text:!0});jQuery(".crop").button({icons:{primary:"ui-icon-arrow-4-diag"},text:!0});jQuery(".show").button({icons:{primary:"ui-icon-lightbulb"},
text:!0});jQuery(".size_options").buttonset()},displayChange:function(b){b=jQuery(b);var a=b.closest("tr");if(a.hasClass("new_size"))return!1;var c=a.find("input.h"),e=a.find("input.w"),f=a.find("input.c"),g=a.find("input.s"),d=a.find("input.n"),k=c.val(),j=e.val(),l=a.find("label.c").hasClass("ui-state-active"),a=a.find("label.s").hasClass("ui-state-active"),m=d.val(),c=c.attr("base_h"),e=e.attr("base_w"),f=f.attr("base_c"),g=g.attr("base_s"),d=d.attr("base_n");k!=c||j!=e||l!=("0"==f?!1:!0)||a!=
("0"==g?!1:!0)||m!=d?b.closest("td").addClass("notSaved").find(".add_size").css("display","inline-block"):b.closest("td").removeClass("notSaved").find(".add_size").css("display","none")}};
jQuery(function(){var b=jQuery("#wpbody-content");jQuery("#ajax_thumbnail_rebuild").click(function(){rahe.sis.regenerate.checkStartRegenerating()});b.on("click","#add_size",function(a){rahe.sis.sizes.add(a,this)}).on("click",".add_size_name",function(a){rahe.sis.sizes.register(a,this)}).on("click",".delete_size",function(a){rahe.sis.sizes.deleteSize(a,this)}).on("click",".add_size",function(a){rahe.sis.sizes.ajaxRegister(a,this)}).on("click skeyup change",".h,.w,.c,.s,.n",function(){rahe.sis.sizes.displayChange(this)}).on("click",
"#get_php",function(a){rahe.sis.sizes.getPhp(a,this)});jQuery("#get_php").nextAll("code").hide();jQuery("span.custom_size").closest("tr").children("th").css({color:"#89D76A"});jQuery("span.theme_size").closest("tr").children("th").css({color:"#F2A13A"});jQuery(".add_size").hide();jQuery('<div class="ui-widget" id="msg"><div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"><p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><strong>Alert:</strong> <ul class="msg" ></ul></p></div></div>').prependTo("div#wpwrap").slideUp(0);
jQuery("#msg").ajaxError(function(a,b,e){jQuery(this).find(".msg").append("<li>"+sis.ajaxErrorHandler+" "+e.url+", status "+b.status+" : "+b.statusText+"</li>").end().stop(!1,!1).slideDown(200).delay(5E3).slideUp(200)});rahe.sis.sizes.setButtons()});